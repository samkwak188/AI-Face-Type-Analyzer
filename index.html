<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Type Prediction</title>

    <link rel="apple-touch-icon" sizes="57x57" href="./favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="./favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="./favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon/favicon-16x16.png">
    <link rel="manifest" href="./favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="social-icons">
        <a href="https://youtube.com" target="_blank">
            <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" alt="YouTube">
        </a>
        <a href="https://github.com/samkwak188" target="_blank">
            <img src="https://cdn-icons-png.flaticon.com/512/25/25231.png" alt="GitHub">
        </a>
    </div>
    <div class="language-toggle">
        <select id="languageSelect" onchange="changeLanguage(this.value)">
            <option value="ko">í•œêµ­ì–´</option>
            <option value="en">English</option>
        </select>
    </div>
    <h1>AIê°€ ì•Œë ¤ì£¼ëŠ” ë‚´ ì–¼êµ´ìƒ!</h1>
    <div id="image-preview"></div>
    <div id="loader" class="loader"></div>
    <div id="loader-text" style="text-align: center; margin-top: 10px; display: none;">AIê°€ ì‚¬ì§„ì„ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤</div>
    <div class="file-upload">
        <label for="imageUpload" class="custom-file-upload">ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
        <input type="file" id="imageUpload" accept="image/*" onchange="handleFileSelect(this)" />
    </div>
    <div class="gender-title">ì„±ë³„ì„ ì„ íƒí•˜ì„¸ìš”</div>
    <div class="gender-toggle-container">
        <span class="gender-label female">ì—¬ì</span>
        <input type="checkbox" id="gender" onchange="selectGender(this.checked)">
        <label for="gender">
            <span class="knob"><i></i></span>
        </label>
        <span class="gender-label male">ë‚¨ì</span>
    </div>
    <button id="startButton" onclick="predictImage()" disabled>ë‚˜ì˜ ì–¼êµ´ìƒ í™•ì¸í•˜ê¸°!</button>
    <div id="prediction-results">
        <div id="label-container"></div>
        <div id="result-message"></div>
    </div>
    <div class="reset-container">
        <button id="resetButton" onclick="resetPage()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        const URL = "./my_model/";
        let model, labelContainer, maxPredictions, selectedFile;

        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            if (labelContainer) {
                labelContainer.innerHTML = '';
            }

            try {
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                labelContainer = document.getElementById("label-container");
                for (let i = 0; i < maxPredictions; i++) {
                    const predictionBar = document.createElement("div");
                    predictionBar.className = "prediction-bar";
                    predictionBar.innerHTML = `
                        <div class="label" data-class=""></div>
                        <div class="bar">
                            <div class="bar-fill"></div>
                        </div>
                    `;
                    labelContainer.appendChild(predictionBar);
                }
            } catch (error) {
                console.error("Model initialization error:", error);
                displayErrorMessage("ëª¨ë¸ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        }

        function handleFileSelect(input) {
            selectedFile = input.files[0];
            if (selectedFile) {
                document.getElementById("startButton").disabled = false;
                showImagePreview(selectedFile);
            }
        }

        function showImagePreview(file) {
            const preview = document.getElementById("image-preview");
            preview.innerHTML = "";
            const img = document.createElement("img");
            img.src = window.URL.createObjectURL(file);
            img.style.maxWidth = "100%";
            img.style.height = "auto";
            preview.appendChild(img);
        }

        async function predictImage() {
            try {
                // Hide elements when prediction starts
                document.querySelector('.file-upload').style.display = 'none';
                document.getElementById('startButton').style.display = 'none';
                document.querySelector('.gender-toggle-container').style.display = 'none';
                document.querySelector('.gender-title').style.display = 'none';
                document.querySelector('.language-toggle').style.display = 'none';  // Hide language toggle
                
                document.getElementById('loader').style.display = 'block';
                document.getElementById('loader-text').style.display = 'block';
                document.getElementById('label-container').innerHTML = '';
                document.getElementById('result-message').innerHTML = '';

                if (!model) {
                    await init();
                }

                const image = new Image();
                image.src = window.URL.createObjectURL(selectedFile);

                image.onload = async () => {
                    try {
                        const prediction = await model.predict(image);
                        if (prediction && prediction.length > 0) {
                            displayPrediction(prediction);
                            document.getElementById('resetButton').style.display = 'block';
                        } else {
                            displayErrorMessage("ì˜ˆì¸¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                        }
                    } catch (error) {
                        console.error(error);
                        displayErrorMessage("ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    } finally {
                        document.getElementById('loader').style.display = 'none';
                        document.getElementById('loader-text').style.display = 'none';
                        window.URL.revokeObjectURL(image.src);
                    }
                };
            } catch (error) {
                console.error(error);
                displayErrorMessage("ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                document.getElementById('loader').style.display = 'none';
                document.getElementById('loader-text').style.display = 'none';
            }
        }

        function displayPrediction(prediction) {
            const currentLang = translations[document.getElementById('languageSelect').value];
            const resultContainer = document.getElementById('result-message');
            resultContainer.innerHTML = '';

            const existingTitles = document.querySelectorAll('.result-title');
            existingTitles.forEach(title => title.remove());

            let highestProbability = 0;
            let highestClass = '';

            const barFills = document.querySelectorAll('.bar-fill');
            barFills.forEach(bar => {
                bar.style.transition = 'width 4s ease-out';
                bar.style.width = '0%';
            });

            void document.getElementById('label-container').offsetHeight;

            for (let i = 0; i < maxPredictions; i++) {
                const classPrediction = prediction[i].className;
                const probability = prediction[i].probability * 100;

                const predictionBar = labelContainer.childNodes[i];
                const label = predictionBar.querySelector('.label');
                const barFill = predictionBar.querySelector('.bar-fill');

                label.textContent = currentLang.faceTypes[classPrediction];
                label.style.fontSize = '14px';

                requestAnimationFrame(() => {
                    barFill.style.width = probability + '%';
                    barFill.style.backgroundColor = getColor(i);
                });

                if (probability > highestProbability) {
                    highestProbability = probability;
                    highestClass = classPrediction;
                }
            }

            const titleMessage = document.createElement('div');
            titleMessage.className = 'result-title';
            titleMessage.setAttribute('data-face-type', highestClass);
            titleMessage.textContent = `${currentLang.faceTypes[highestClass]}!`;

            const predictionResults = document.getElementById('prediction-results');
            predictionResults.insertBefore(titleMessage, document.getElementById('label-container'));

            const detailMessage = document.createElement('div');
            detailMessage.className = 'result-detail';

            const mainMessage = document.createElement('div');
            mainMessage.style.fontSize = '16px';
            mainMessage.style.marginBottom = '15px';
            mainMessage.textContent = currentLang.descriptions[highestClass];

            const celebList = document.createElement('div');
            celebList.style.fontSize = '14px';
            celebList.style.color = '#666666';
            celebList.textContent = currentLang.celebs[highestClass][window.selectedGender];

            detailMessage.appendChild(mainMessage);
            detailMessage.appendChild(celebList);
            resultContainer.appendChild(detailMessage);

            setTimeout(() => {
                const imagePreview = document.getElementById('image-preview');
                const startPosition = window.pageYOffset;
                const targetPosition = imagePreview.offsetTop - 20;
                const distance = targetPosition - startPosition;
                const duration = 2500;
                let start = null;

                function animation(currentTime) {
                    if (start === null) start = currentTime;
                    const timeElapsed = currentTime - start;
                    const progress = Math.min(timeElapsed / duration, 1);

                    const easing = t => t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;

                    window.scrollTo(0, startPosition + (distance * easing(progress)));

                    if (progress < 1) {
                        requestAnimationFrame(animation);
                    }
                }

                requestAnimationFrame(animation);
            }, 1000);
        }

        function getColor(index) {
            const colors = ['#ff9800', '#f44336', '#3f51b5', '#2196f3'];
            return colors[index % colors.length];
        }

        function displayErrorMessage(message) {
            const existingErrors = document.querySelectorAll('.error-message');
            existingErrors.forEach(error => error.remove());

            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.style.color = 'red';
            errorDiv.style.textAlign = 'center';
            errorDiv.style.margin = '20px 0';
            errorDiv.textContent = message;

            const imagePreview = document.getElementById('image-preview');
            imagePreview.parentNode.insertBefore(errorDiv, imagePreview.nextSibling);

            document.getElementById('resetButton').style.display = 'block';
        }

        function getKoreanLabel(className) {
            switch (className) {
                case 'Tofu':
                    return 'ë‘ë¶€ìƒ';
                case 'TofuEdge':
                    return 'ë‘ë¶€ëª¨ì„œë¦¬ìƒ';
                case 'Arab':
                    return 'ì•„ëìƒ';
                case 'Milk':
                    return 'ìš°ìœ ìƒ';
                default:
                    return className;
            }
        }

        function resetPage() {
            document.querySelector('.language-toggle').style.display = 'block';
            window.location.reload();
        }

        function selectGender(isChecked) {
            window.selectedGender = isChecked ? 'male' : 'female';
        }

        window.selectedGender = 'female';

        const translations = {
            ko: {
                title: "AIê°€ ì•Œë ¤ì£¼ëŠ” ë‚´ ì–¼êµ´ìƒ!",
                uploadButton: "ì´ë¯¸ì§€ ì—…ë¡œë“œ",
                genderTitle: "ì„±ë³„ì„ ì„ íƒí•˜ì„¸ìš”",
                genderMale: "ë‚¨ì",
                genderFemale: "ì—¬ì",
                startButton: "ë‚˜ì˜ ì–¼êµ´ìƒ í™•ì¸í•˜ê¸°!",
                resetButton: "ë‹¤ì‹œ í•˜ê¸°",
                loading: "AIê°€ ì‚¬ì§„ì„ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤",
                faceTypes: {
                    'Tofu': 'ë‘ë¶€ìƒ',
                    'TofuEdge': 'ë‘ë¶€ëª¨ì„œë¦¬ìƒ',
                    'Arab': 'ì•„ëìƒ',
                    'Milk': 'ìš°ìœ ìƒ'
                },
                descriptions: {
                    'Tofu': 'ë‚˜ëŠ” í•˜ì–—ê³  ë½€ì–€ ë‘ë¶€ìƒ!ğŸ®\nì´ëª©êµ¬ë¹„ê°€ ì§„í•˜ì§€ ì•Šê³  ì „ë°˜ì ìœ¼ë¡œ ë™ê¸€ë™ê¸€í•œ ê·€ì—¬ìš´ ëŠë‚ŒğŸ¶\n\nì„ í•˜ê³  ë¶€ë“œëŸ¬ìš´ ì²­ìˆœí•˜ê³  ê¹¨ë—í•œ ë¶„ìœ„ê¸°ë¡œ ì–´ë”œê°€ë‚˜ ì¸ê¸°ìŸì´~',
                    'TofuEdge': 'ë‘ë¶€ìƒ, ì•„ëìƒ? ë‚˜ëŠ” ë°”ë¡œ ìš”ì¦˜ ëŒ€ì„¸ë¼ëŠ” ë‘ë¶€ëª¨ì„œë¦¬ìƒâœ¨\në½€ì–—ì§€ë§Œ ì´ëª©êµ¬ë¹„ê°€ ë³´ë‹¤ ëšœë ·í•˜ê³  ë‚ ë µí•œê²Œ ë‘ë¶€ ëª¨ì„œë¦¬ì™€ ê°™ì•„ì„œğŸ¤ë‘ë¶€ ëª¨ì„œë¦¬ìƒğŸ¤\n\ní‰ì†Œì—” ë‚ ì¹´ë¡œìš´ ì•„ë ì¸ìƒ, ê·¼ë° ì›ƒìœ¼ë©´ ë°”ë¡œ ë‘ë¶€ë‘ë¶€ê°€ ë˜ëŠ”ê²Œ íŠ¹ì§•!',
                    'Arab': 'ë‚˜ëŠ” ëˆˆì½”ì… ëšœë ·í•œ ì•„ëìƒ!ğŸ˜\ní‹°ì¡´ë°œë‹¬, ëˆˆì½”ì… ëª¨ë‘ ëšœë ·í•œ ì •ì„ ë¯¸ë‚¨ë¯¸ë…€~ğŸ¤«ğŸ§\n\nìŒì»¤í”Œì´ ì§„í•˜ê³  ëˆˆì¹, ì†ëˆˆì¹ë“± ì§„í•˜ê²Œ ë°œë‹¬í•´ì„œ êµµì§í•œ ë¼ì¸ê³¼ ì´êµ­ì ì¸ ë¶„ìœ„ê¸°ë¥¼ í’ê¸°ëŠ”ê²Œ íŠ¹ì§•!',
                    'Milk': 'ì˜¤ë°€ì¡°ë°€! ë‚˜ëŠ” ë°˜ì§ì´ëŠ” ìš°ìœ ìƒ!ğŸ¥›\në§‘ê³  ê¹¨ë—í•œ ëŠë‚Œì„ í’ê¸°ëŠ” ê¹”ë”í•˜ê³  ì¡°í™”ë¡œìš´ ì´ëª©êµ¬ë¹„!\n\ní•­ìƒ âœ¨ë°˜ì§ì´ëŠ” ëˆˆâœ¨ê³¼ ì„ ëª…í•œ ì–¼êµ´ì„ !\n\në³¼ì‚´ì´ ìš°ìœ ê°™ì€ í¬ë¿Œì—° ëŠë‚Œì„ ì£¼ëŠ”ê²Œ íŠ¹ì§•!'
                },
                celebs: {
                    'Tofu': {
                        male: 'ë‘ë¶€ìƒ ë‚¨ìì—°ì˜ˆì¸: ì¥ë™ìœ¤, ì´ì •í•˜, ë°©íƒ„ì†Œë…„ë‹¨ ì§„, ì„ì‹œì™„, ë°•ë³´ê²€, ì—ë¦­ë‚¨, í”¼ì˜¤'
                    },
                    'TofuEdge': {
                        male: 'ë‘ë¶€ëª¨ì„œë¦¬ìƒ ë‚¨ìì—°ì˜ˆì¸: ëª¬ìŠ¤íƒ€ì—‘ìŠ¤ ê¸°í˜„, ë¼ì´ì¦ˆ ì„±ì°¬, NCT ì •ìš°, ìƒ¤ì´ë‹ˆ í‚¤, ë³€ìš°ì„, EXO ë°±í˜„'
                    },
                    'Arab': {
                        male: 'ì•„ëìƒ ë‚¨ìì—°ì˜ˆì¸: ì´ë™ìš±, ìƒ¤ì´ë‹ˆ ë¯¼í˜¸, ì‹ í˜„ì¤€, ì°¨ìŠ¹ì›, ì‹ í™” ì—ë¦­, ë¡œëª¬'
                    },
                    'Milk': {
                        male: 'ìš°ìœ ìƒ ë‚¨ìì—°ì˜ˆì¸: ì†¡ì¤‘ê¸°, ì¥ìš°ì˜, ìµœìš°ì‹, ë°•í˜•ì‹, ì´ì œí›ˆ'
                    }
                }
            },
            en: {
                title: "AI Face Type Analysis!",
                uploadButton: "Upload Image",
                genderTitle: "Select Gender",
                genderMale: "Male",
                genderFemale: "Female",
                startButton: "Analyze My Face!",
                resetButton: "Try Again",
                loading: "AI is analyzing your photo",
                faceTypes: {
                    'Tofu': 'Tofu',
                    'TofuEdge': 'Tofu Edge',
                    'Arab': 'Hunter',
                    'Milk': 'Milk'
                },
                descriptions: {
                    'Tofu': 'I have the soft and pure Tofu face!ğŸ®\nWith gentle features and an overall round, cute appearanceğŸ¶\n\nPure and gentle vibes make me popular everywhere~',
                    'TofuEdge': 'Tofu or Hunter? I\'m the trending Tofu Edge type!âœ¨\nFair complexion but with more defined features, sharp like the edge of tofuğŸ¤\n\nLooks sharp like Hunter type normally, but becomes soft like tofu when smiling!',
                    'Arab': 'I have distinct Hunter face type!ğŸ˜\nWell-defined T-zone and facial features~ğŸ¤«ğŸ§\n\nStrong double eyelids, eyebrows, and lashes creating bold lines and exotic atmosphere!',
                    'Milk': 'Delicate! I have the glowing Milk face!ğŸ¥›\nClean and harmonious features with a clear complexion!\n\nâœ¨Sparkling eyesâœ¨ and clear facial lines!\n\nCheeks have that milky, translucent quality!'
                },
                celebs: {
                    'Tofu': {
                        male: 'Male celebrities: Jang Dong-yoon, Lee Jung-ha, BTS Jin, Im Si-wan, Park Bo-gum, Eric Nam, P.O',
                        female: 'Female celebrities: Kim Go-eun, Oh My Girl Arin, LE SSERAFIM Kazuha, NewJeans Hanni'
                    },
                    'TofuEdge': {
                        male: 'Male celebrities: MONSTA X KIHYUN, RAISE CHAN, NCT DONGHYUK, SHINee KEY, BAEKHYUN, EXO Baekhyun',
                        female: 'Female celebrities: KIOF Ha-neul, Baby Monster Luka, NewJeans Minji, Go Yoon-jeong'
                    },
                    'Arab': {
                        male: 'Male celebrities: Lee Dong-ook, SHINee Minho, Shin Hye-jun, Cha Seung-won, SHINee Eric, Lo Moon',
                        female: 'Female celebrities: Kim Ji-won, TWICE Ji-hyo, NewJeans Hyein, NewJeans Daniel, aespa Ningning'
                    },
                    'Milk': {
                        male: 'Male celebrities: Song Chung-gi, Jang Woo-yeong, Choi Woo-sik, Park Hyung-sik, Lee Jae-hoon',
                        female: 'Female celebrities: aespa Winter, IU, ENMIX Bae, Jang Won-young, IZ*ONE Yuna, Go Ara'
                    }
                }
            }
        };

        function changeLanguage(lang) {
            const currentLang = translations[lang];
            
            
            document.querySelector('h1').textContent = currentLang.title;
            document.querySelector('.custom-file-upload').textContent = currentLang.uploadButton;
            document.querySelector('.gender-title').textContent = currentLang.genderTitle;
            document.querySelector('.gender-label.male').textContent = currentLang.genderMale;
            document.querySelector('.gender-label.female').textContent = currentLang.genderFemale;
            document.querySelector('#startButton').textContent = currentLang.startButton;
            document.querySelector('#resetButton').textContent = currentLang.resetButton;
            document.querySelector('#loader-text').textContent = currentLang.loading;
            
            
            localStorage.setItem('preferredLanguage', lang);
            
            //update results
            updateResults(lang);

            // Update prediction bar labels if they exist
            const predictionBars = document.querySelectorAll('.prediction-bar');
            predictionBars.forEach(bar => {
                const label = bar.querySelector('.label');
                const originalClass = label.getAttribute('data-class');
                if (originalClass) {
                    label.textContent = currentLang.faceTypes[originalClass];
                }
            });
        }

        
        function updateResults(lang) {
            const resultTitle = document.querySelector('.result-title');
            if (resultTitle) {
                const faceType = resultTitle.getAttribute('data-face-type');
                if (faceType) {
                    const currentLang = translations[lang];
                    resultTitle.textContent = `${currentLang.faceTypes[faceType]}!`;
                    
                    const resultMessage = document.querySelector('.result-message');
                    if (resultMessage) {
                        const gender = window.selectedGender;
                        resultMessage.innerHTML = `
                            ${currentLang.descriptions[faceType]}\n\n
                            ${currentLang.celebs[faceType][gender]}
                        `;
                    }
                }
            }
        }

    
        document.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('preferredLanguage') || 'ko';
            document.getElementById('languageSelect').value = savedLang;
            changeLanguage(savedLang);
        });
    </script>
</body>

</html>